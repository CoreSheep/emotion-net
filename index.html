<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Emotion Net Mini</title>
    <meta name="keywords" content="KG Multimodal emotion net" />
    <meta name="author" content="sheepcore" />
    <link rel="shortcut icon" href="assets/images/icon/project-icon.svg">
    <!--  link outer css stylesheet  -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap-theme.css">
    <!--    link framework css stylesheet-->
    <link rel="stylesheet" href="css/framework.css">
    <!--    link canvas css stylesheet  -->
    <link rel="stylesheet" href="css/canvas.css">
    <!--    link imageContainer css stylesheet-->
    <link rel="stylesheet" href="css/imageContainer.css">
    
    <!--link outer js lib-->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
</head>
<body>
<!-- Title -->
<div style="height: 5em">
    <h1 id="emotionNetName">Emotion Net Mini</h1>
    <div id='darkMode' style="display:inline-block;">
        <span style="position: absolute; right: 30px; margin-bottom: 25px; margin-top: 15px;"><strong>dark mode</strong></span>
    </div>
</div>

<!-- Define div for relationship graph -->
<!-- NOTE: Parent element uses relative positioning, child elements use absolute positioning -->
<div style="text-align: center;position: relative;">
    <svg width="880" height="580" style="position: relative; top: 15px; margin-left: auto; margin-right: auto; margin-bottom: -150px; display: block;" id="canvas"></svg>
    
    <!-- Mode (circle/text) -->
    <div id="mode">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">Circles</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -9px">&nbsp;Texts</span>
    </div>
    
    <!-- Search box -->
    <div id="search">
        <input type="text" autocomplete="off" class="form-control">
    </div>
    
    <!-- Legend -->
    <div id="label"></div>
    
    
    <!-- Display toggle 1 On/Off -->
    <div id="switcher1">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- Display toggle 2 On/Off -->
    <div id="switcher2">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- Display toggle 3 On/Off -->
    <div id="switcher3">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- Display toggle 4 On/Off -->
    <div id="switcher4">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- Node information -->
    <div id="labelProperty">
        <h4 style="margin-left: -3px">Word Property</h4>
        <div id="subclass"></div>
        <div id="description"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="faceImageContainer1"></u>
            </div>
        </div>
        <div id="tag1"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="faceImageContainer2"></u>
            </div>
        </div>
        <div id="tag2"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="faceImageContainer3"></u>
            </div>
        </div>
        <div id="tag3"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="emojiImageContainer"></u>
            </div>
        </div>
        <div id="tag4"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="animalImageContainer"></u>
            </div>
        </div>
        <div id="tag5"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="animalImageContainer2"></u>
            </div>
        </div>
        <div id="tag6"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="animalImageContainer3"></u>
            </div>
        </div>
    </div>
    
    <!-- Tooltips -->
    <div id="tooltips">
        <span style="font-size: 14px; color: rgba(22,116,31,0.78); font-weight: bold">tooltip:</span><br>
        <small>1. Click Circle/Text to switch modes</small><br>
        <small>2. Click On/Off to show/hide nodes</small><br>
        <small>3. Drag nodes to adjust layout</small><br>
        <small>4. Hover over nodes to see details</small><br>
    </div>
</div>

<div id="project-footer">
    <span style="font-size: small;color: rgba(123,135,138,0.75); font-family: 'SimSun';">designed by @sheepcore</span>
</div>
</body>
<!--    <script src="../D3jsConquer/js/d3.v5.min.js"></script>-->
<script src="https://d3js.org/d3.v5.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        // Select current canvas object
        var canvas = d3.select("#canvas");
        var width = canvas.attr("width");
        var height = canvas.attr("height");
        // console.log(canvas, width, height);

        const EMOTION_NAMES = ['Center', 'Emotion', 'Category', 'WordEmotion']; //, 'WordEmotion'
        const RELATION_NAMES = {"SUBCLASS_OF": "Subclass", "PART_OF": "Part Of", "RELATED_TO": "Related"};
        const CIRCLE_SIZE = [25, 16, 12, 10];
        const LABEL_TEXT_FONT_SIZE = [20, 16, 10, 8];
        const EMOTION_CATEGORIES = ["Joy", "Peace", "Respect", "Praise", "Trust", "Love", "Blessing", "Anger", "Sadness", "Disappointment", "Guilt",
            "Longing", "Panic", "Fear", "Shame", "Depression", "Hatred", "Disapproval", "Jealousy", "Doubt", "Surprise"];

        const EMOTIONS = ["Joy", "Good", "Anger", "Sadness", "Fear", "Disgust", "Surprise"];

        // console.log(CircleSize["EmotionCenter"]);
        const NODE_COLORS = ['rgba(160,134,48,0.98)', 'rgba(142,74,74,0.98)', 'rgba(66,131,80,0.96)', "rgba(102,93,145,0.96)"];

        for (var i = 0; i < EMOTION_NAMES.length; i++) {
            $('#label').append("<div><span style='background-color:" + NODE_COLORS[i] + "'></span>" + EMOTION_NAMES[i] +"</div>")
        }

        // var graph = d3.json("./assets/graph/emotion-net.json", function (data) {

        // Customize node interaction forces
        var forceManyBody = d3.forceManyBody()
            .strength(-46)   // Small repulsive force, defines force that can push nodes 5px
            .distanceMin(1) // Define a minimum distance, only distances greater than this will generate force
            .distanceMax(1500);

        // Customize link attraction force
        var forceLink = d3.forceLink()
            .distance(50)
            .iterations(4);

        // Customize node collision force
        var forceCollide =  d3.forceCollide()
            .radius(20)
            .iterations(4);

        var forceRadial = d3.forceRadial(25);

        var forceCenter = d3.forceCenter(width / 2, height / 2);


        // Define collision force to prevent node overlapping
        // d3.forceCollide(int radius) passes a collision radius
        // collide.strength(float strength) passes a float collision strength for calculating collision trajectory (larger = faster calculation, higher overhead) default 0.7 (value between 0-1)
        // collide.iterations(int count) larger count value = stronger collision rigidity (rigidity of the constraint)

        // var forceCollide = d3.forceCollide(2);

        var nodes, links, node, link, lineText, text;
        /**
         * Promise asynchronous call mechanism
         */
        d3.json("./assets/mini-graph/mini-emotion-net.json").then(function (data) {
            // var links = graph.links.map(d => Object.create(d));
            // var nodes = graph.nodes.map(d => Object.create(d));
            nodes = data.nodes;
            links = data.links;

            // Update data
            link = canvas.append('g')
                .attr("class", "links")
                .selectAll("line")
                .data(links)
                .enter()
                .append("line")
                .attr('stroke-width', d => 1);

            // Text on edges (relationships between entities)
            lineText = canvas.append('g')
                .attr("class", "lineTexts")
                .selectAll("text")
                .data(links)
                .enter()
                .append("text")
                .attr("class", "inactive")
                .text(d => RELATION_NAMES[d.relation]);

            // Apply various forces to nodes and edges
            // Customize force simulator and add various custom forces
            var simulation = d3.forceSimulation()
                .nodes(nodes)
                .velocityDecay(0.6)
                .force("link", forceLink.links(links).id(d => d.id))
                .force("charge", forceManyBody)
                // .force("radial", forceRadial)
                .force("collide", forceCollide)
                .force("center", forceCenter);

            // Add all nodes
            node = canvas.append('g')
                .attr('class', 'nodes')
                .selectAll('circle')
                .data(nodes)
                .enter()
                .append('circle')
                .attr("r", d => CIRCLE_SIZE[d.group - 1])
                .attr('fill', d => NODE_COLORS[d.group - 1])
                .attr('stroke', 'none')    // No stroke
                .attr('name', d => d.id)
                .call(drag(simulation));   // End drag

            // Text
            // Two display modes, each node can be represented by a circle or text
            text = canvas.append('g')
                .attr("class", "texts")
                .selectAll("text")
                .data(nodes)
                .enter()
                .append("text")
                .attr("display", "none")
                .attr("font-size", d => LABEL_TEXT_FONT_SIZE[d.group - 1])
                .attr("fill", d => NODE_COLORS[d.group - 1])
                .attr('name', d => d.id)
                .text(d => d.id)
                .attr('text-anchor', 'middle')
                .call(drag(simulation));

            // Add title to node, when mouse hovers over circle
            node.append('title').text(d => d.id);

            // $("#canvas").on("mouseenter", function (e) {
            //     d3.select("#canvas").attr("class",  "showBorder");
            // });
            //
            // $("#canvas").on("mouseleave", function (e) {
            //     d3.select("#canvas").removeClass("showBorder");
            // });


            simulation.on("tick", ticked);

            var PositionBias = 350;
            scaleLinear = d3.scaleLinear([0, 10], d3.range(30));
            var PositionFactor = Math.floor(Math.random() * 10 + 1);
            var PositionJustify = scaleLinear(PositionFactor);

            function ensureXInCanvas(x) {
                var alterX = x;
                if (x > width + PositionBias) alterX = width - PositionJustify;
                if (x < 0 - PositionBias) alterX = PositionJustify;
                return alterX;
            }

            function ensureYInCanvas(y) {
                var alterY = y;
                if (y > height + PositionBias) alterY = height - PositionJustify;
                if (y < 0 - PositionBias) alterY = PositionJustify;
                return alterY;
            }

            function ticked() {
                // Update current x,y values of both endpoints of each edge
                // Each time tick fires, apply force
                // Each node velocity v = v * (1 - alphaDecay)
                link
                    .attr("x1", d => ensureXInCanvas(d.source.x))
                    .attr("y1", d => ensureYInCanvas(d.source.y))
                    .attr("x2", d => ensureXInCanvas(d.target.x))
                    .attr("y2", d => ensureYInCanvas(d.target.y));

                // Update center coordinate values cx, cy of each node
                node
                    .attr("cx", d => ensureXInCanvas(d.x))
                    .attr("cy", d => ensureYInCanvas(d.y));

                lineText
                    .attr("dx", d => (d.source.x + d.target.x) / 2)
                    .attr("dy", d => (d.source.y + d.target.y) / 2);

                text
                    .attr("dx", d => ensureXInCanvas(d.x))
                    .attr("dy", d => ensureYInCanvas(d.y));
            }

            var isDragging = false;
            function drag(simulation) {
                // Start dragging
                function dragstarted(d) {
                    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                    isDragging = true;
                }

                function dragged(d) {
                    d.fx = d3.event.x;
                    d.fy = d3.event.y;
                }

                function dragended(d) {
                    if (!d3.event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                    isDragging = false;
                }
                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }

            // Handle zoom
            canvas.call(d3.zoom()
                .scaleExtent([1 / 4, 4])
                .on("zoom", zoomed));

            function zoomed() {
                link.attr("transform", d3.event.transform);
                node.attr("transform", d3.event.transform);
                text.attr("transform", d3.event.transform);
                lineText.attr('transform', d3.event.transform);
            }

            // Update display data based on mode switch
            $('#mode span').click(function(event) {
                // Remove active from all spans in mode
                // Set clicked one as active
                $('#mode span').removeClass('active');
                $(this).addClass('active');

                if ($(this).text() == 'Circles') {
                    // Hide all svg elements in text
                    // Show those in node
                    $('.texts text').hide();
                    $('.nodes circle').show();


                }
                else {
                    $('.texts text').show();
                    $('.nodes circle').hide();
                }
            });

            // A label switch array, true means on, false means off
            // NaN is the first element of the array, used as placeholder
            var switcher = [NaN, true, true, true, true];

            // Handle Center switch click event
            $('#switcher1 span').click(function() {
                // Remove active from all spans in mode
                // Set clicked one as active
                $('#switcher1 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                // Show center emotion
                if ($(this).text() =='On') {
                    // Find nodes belonging to current group and show their connected edges
                    switcher[1] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){

                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive'
                        }
                    });

                    // Show edges
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });
                }
                // Hide nodes and associated edges
                else {
                    switcher[1] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });

                    // Hide edges connected to EmotionCenter
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + "inactive";
                        }
                    });

                    // Hide text of EmotionCenter nodes
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // Handle Category switch click event
            $('#switcher2 span').click(function() {
                $('#switcher2 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                // Show EmotionCategory emotion category
                if ($(this).text() =='On') {
                    // Find nodes belonging to current group and show their connected edges
                    switcher[2] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                // Hide nodes and associated edges
                else {
                    switcher[2] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Hide edges connected to Category
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Hide text of Category nodes
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // Handle Emotion switch event
            $('#switcher3 span').click(function() {
                $('#switcher3 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                // Show Emotions emotion subcategory
                if ($(this).text() =='On') {
                    // Find nodes belonging to current group and show their connected edges
                    switcher[3] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Show edges
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                // Hide Emotion nodes and associated edges
                else {
                    switcher[3] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Hide edges connected to EmotionCenter
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });


                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // Handle WordEmotion switch event
            $('#switcher4 span').click(function() {
                // Remove active from all spans in mode
                // Set clicked one as active
                $('#switcher4 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                // Show center emotion
                if ($(this).text() =='On') {
                    // Find nodes belonging to current group and show their connected edges
                    switcher[4] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Show edges
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                // Hide WordEmotion nodes and associated edges
                else {
                    switcher[4] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // Currently WordEmotion node display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Hide edges connected to WordEmotion class nodes
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Hide text on WordEmotion class nodes
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // Currently selected type entity display
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // function loadData(url, callback) {
            //     var rawFile = new XMLHttpRequest();
            //     rawFile.open("GET", url, true);
            //     rawFile.onreadystatechange = function() {
            //         if (rawFile.readyState === 4 && rawFile.status == "200") {
            //             callback(rawFile.responseText);
            //         }
            //     };
            //     rawFile.send(null);
            // }
            //
            // loadData("../../EmotionNet/assets/mini-graph/mini-label-info.json", d =>  labelInfoAll = JSON.parse(d));
            // loadData("../../EmotionNet/assets/mini-graph/mini-emotion-net.json", d =>  emotionNet = JSON.parse(d));

            var labelInfoAll;
            const imageNums = 10;
            const IMAGE_CATEGORIES = ['HA1_P', 'GD1_P', 'AN1_P', 'SA1_P', 'FE1_P', 'DI1_P', 'SU1_P'];
            const ANIMAL_EMOTIONS_NUMS = 3;
            const IMAGE_CATEGORIES_ANIMALS = ['happy_0', 'good_0', 'angry_0', 'sad_0', 'fear_0',
                'disgust_0', 'surprise_0'];


            /**
             * Handle node focus event
             * handle node's focus event
             */
            var DARKMODE = false;
            // d3.json("./assets/mini-graph/mini-emotion-net.json");
            d3.json("./assets/mini-graph/mini-label-info.json").then(function (data) {
                labelInfoAll = data;

                $("#darkMode").on("click", function (e) {
                    DARKMODE = !DARKMODE;
                    if (DARKMODE) {
                        $("body").addClass("darkMode");
                        $("#emotionNetName").addClass("darkMode");
                        $("#label").addClass("darkMode");
                        $("#mode span").addClass("darkMode");
                        $("#darkMode span").addClass("darkMode").html("<strong>light mode</strong>");
                        $("#switcher1 span").addClass("darkMode");
                        $("#switcher2 span").addClass("darkMode");
                        $("#switcher3 span").addClass("darkMode");
                        $("#switcher4 span").addClass("darkMode");
                        $("#tooltips").addClass("darkMode");
                        $("#search input").addClass("darkMode");
                        $("#canvas").addClass("darkMode");
                        var addDarkModeClass = 'darkMode ';
                        d3.select('#canvas .links').selectAll('line').attr('class', function(d) {
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive';
                            }
                        });
                        d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        d3.select('#canvas .lineTexts').selectAll('text').attr('class', 'darkMode inactive');

                    } else {
                        $("body").removeClass("darkMode");
                        $("#emotionNetName").removeClass("darkMode");
                        $("#label").removeClass("darkMode");
                        $("#mode span").removeClass("darkMode");
                        $("#darkMode span").removeClass("darkMode").html("<strong>dark mode</strong>");
                        $("#switcher1 span").removeClass("darkMode");
                        $("#switcher2 span").removeClass("darkMode");
                        $("#switcher3 span").removeClass("darkMode");
                        $("#switcher4 span").removeClass("darkMode");
                        $("#tooltips").removeClass("darkMode");
                        $("#search input").removeClass("darkMode");
                        $("#canvas").removeClass("darkMode");
                        $(".links line").removeClass("darkMode");

                        var linksClassList = d3.select('#canvas .links').selectAll('line').attr('class').replace("darkMode", '');
                        d3.select('#canvas .links').selectAll('line').attr('class', function(d) {
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return linksClassList;
                            } else {
                                return linksClassList + 'inactive';
                            }
                        });
                        var nodesClassList = d3.select('#canvas .nodes').selectAll('circle').attr('class').replace("darkMode", '');
                        d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                            if (switcher[d.group]) {
                                return nodesClassList;
                            } else{
                                return nodesClassList + 'inactive'
                            }
                        });
                        var textClassList = d3.select('#canvas .lineTexts').selectAll('text').attr('class').replace("darkMode", '');
                        d3.select('#canvas .lineTexts').selectAll('text').attr('class', textClassList);

                    }
                });

                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                $("#canvas").on("mouseenter", ".nodes circle", function (e) {
                    console.log(addDarkModeClass);
                    if (!isDragging) {
                        //取出当前鼠标进入节点的名字，以便后续进行节点隐藏
                        var focusedNode = $(this).attr("name");
                        $("#subclass").empty();
                        $("#description").empty();
                        $("#faceImageContainer1").empty();
                        $("#faceImageContainer2").empty();
                        $("#faceImageContainer3").empty();
                        $("#emojiImageContainer").empty();
                        $("#animalImageContainer").empty();
                        $("#animalImageContainer2").empty();
                        $("#animalImageContainer3").empty();
                        $("#tag1").empty();
                        $("#tag2").empty();
                        $("#tag3").empty();
                        $("#tag4").empty();
                        $("#tag5").empty();
                        $("#tag6").empty();

                        $("#labelProperty h4").css("color", $(this).attr("fill")).text($(this).attr("name"));

                        // Set image click glow and lift effect
                        $('#faceImageContainer1').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });

                        $('#faceImageContainer1').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#faceImageContainer2').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#faceImageContainer2').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#faceImageContainer3').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#faceImageContainer3').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#emojiImageContainer').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#emojiImageContainer').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer2').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer2').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer3').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer3').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        var labelInfo = labelInfoAll[focusedNode];
                        //针对不同类别情绪进行分类别展示（小类情绪词没有图片）
                        //对情绪大类的Property展示
                        // $('.imageContent ul li').on('mouseenter', function () {
                        //     $(this).css('border', '1px wihtesomke solid')
                        // });
                        // $('.imageContent ul li').on('mousemove', '.imageContent ul li', function () {
                        //     $(this).css('display', 'block')
                        // })

                        if (EMOTIONS.indexOf(focusedNode) != -1 || focusedNode == "Expression") {
                            // $("#labelProperty").append("image").attr()
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");

                            $("#description")
                                .append("<div><span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Description" + "</span><br></div>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.DESCRIPTION + "</span>");

                            if (focusedNode == "Expression") {
                                var e;
                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>");

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);

                                }
                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }
                            // Display emotion category
                            else {
                                var emotionType = IMAGE_CATEGORIES[EMOTIONS.indexOf(focusedNode)];
                                var animalEmotionType = IMAGE_CATEGORIES_ANIMALS[EMOTIONS.indexOf(focusedNode)];

                                $("#description")
                                    .append("<div><span class='label' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>");

                                for (let i = 0; i < imageNums; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + emotionType + (i + 1) + ".png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                var emojiNums = 7;
                                $("#tag1").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>")
                                for (let i = 0; i < emojiNums; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + emotionType + (i+1) + ".jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                var animalEmotionsNum = 3;
                                $("#tag2").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>")
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-cat-emotions/" + animalEmotionType + (j+1) + ".jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-dog-emotions/" + animalEmotionType + (j+1) + ".jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-hamster-emotions/" + animalEmotionType + (j+1) + ".jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                            }

                            // Display emotion subclass
                        } else if (EMOTION_CATEGORIES.indexOf(focusedNode) != -1) {
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");
                        } else {
                            // Display word emotion properties
                            var propertyValue = Object.values(labelInfo);
                            var relatedEmotion;
                            if(propertyValue[1] == ""){
                                relatedEmotion  = "None"
                            } else{
                                relatedEmotion = propertyValue[1];
                            }
                            const wordPolarity = ["Neutral", "Positive", "Negative", "Mixed"];

                            $("#description")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Part Of" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[0] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: cornflowerblue'>" + "Related" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + relatedEmotion + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #3e8e41'>" + "Part of Speech" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[2] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #a7a82e'>" + "Intensity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[3] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color:#944b4b;'>" + "Word Meanings" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[4] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background:#665d91;'>" + "Polarity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + wordPolarity[propertyValue[5]] + "</span><br>");

                        }

                        // Iterate through all nodes, select nodes directly connected to the focused node
                        d3.select("#canvas").selectAll(".nodes circle").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Focused node
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            // Display nodes directly connected to the current focused node and whose corresponding switcher is on
                            for (var i = 0; i < links.length; i++) {
                                if (links[i].source.id == focusedNode && links[i].target.id == d.id) {
                                    if (switcher[links[i].target.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                                if (links[i].target.id  == focusedNode && links[i].source.id  == d.id) {
                                    if (switcher[links[i].source.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                            }
                            return addDarkModeClass + "inactive";
                        });

                        // 显示与当前聚焦节点直接相连的边
                        d3.select("#canvas").selectAll(".links line").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // console.log(d.source.id);
                            // console.log(focusedNode.name);
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass + 'focus';
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // 只显示之间相连的关系名
                        d3.select("#canvas").selectAll('.lineTexts text').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass;
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            } else {
                                return addDarkModeClass + "inactive";
                            }
                        });

                        // When mouse hovers over circle node, hide all Text text nodes
                        d3.select('#canvas').selectAll('.texts text').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            for (var i = 0; i < links.length; i++) {
                                if (links[i]['source'].id == focusedNode && links[i]['target'].id == d.id) {
                                    return addDarkModeClass;
                                }
                                if (links[i]['target'].id == focusedNode && links[i]['source'].id == d.id) {
                                    return addDarkModeClass;
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });
                    }
                });

                // When mouse is no longer focused on a selected node
                $('#canvas').on('mouseleave', '.nodes circle', function(event) {
                    if (!isDragging) {
                        // Hide all edge relationships
                        $(".lineTexts text").addClass("inactive");
                        // Cancel focus effect
                        $(".links line").removeClass("focus");

                        // $(".links line").removeClass("inactive");

                        // Display all nodes with label on, if switch is off, set to inactive
                        d3.select('#canvas').selectAll(".nodes circle").attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Display if in group1 and switch label is on
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        // Select edges connected to nodes with label switch on
                        d3.select("#canvas").selectAll('.links line').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Display nodes where both endpoints of the edge belong to the same type and their label switch is on
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + "inactive";
                            }
                        });
                        // Display all text nodes with label on
                        d3.select('#canvas').selectAll('.texts text').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Currently selected type entity display
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                    }
                });

                $("#canvas").on("mouseenter", ".texts text", function (e) {
                    if (!isDragging) {
                        // Get the name of the node the mouse entered, for subsequent node hiding
                        var focusedNode = $(this).attr("name");
                        // Determine display mode
                        // Determine display mode
                        $("#subclass").empty();
                        $("#description").empty();
                        $("#faceImageContainer1").empty();
                        $("#faceImageContainer2").empty();
                        $("#faceImageContainer3").empty();
                        $("#emojiImageContainer").empty();
                        $("#animalImageContainer").empty();
                        $("#animalImageContainer2").empty();
                        $("#animalImageContainer3").empty();
                        $("#tag1").empty();
                        $("#tag2").empty();
                        $("#tag3").empty();
                        $("#tag4").empty();
                        $("#tag5").empty();
                        $("#tag6").empty();

                        $("#labelProperty h4").css("color", $(this).attr("fill")).text($(this).attr("name"));
                        var labelInfo = labelInfoAll[focusedNode];
                        // Display different emotion categories by category (subcategory emotion words have no images)
                        // Display Property for emotion categories
                        if (EMOTIONS.indexOf(focusedNode) != -1 || focusedNode == "Expression") {
                            // $("#labelProperty").append("image").attr()
                            // Display subclass emotion information
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");

                            // Add description information for each emotion category
                            $("#description")
                                .append("<div><span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Description" + "</span><br></div>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.DESCRIPTION + "</span>");

                            if (focusedNode == "Expression") {
                                var e;

                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>")

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>")
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);
                                }

                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }

                            // Display emotion category
                            else {
                                var emotionType = IMAGE_CATEGORIES[EMOTIONS.indexOf(focusedNode)];
                                var animalEmotionType = IMAGE_CATEGORIES_ANIMALS[EMOTIONS.indexOf(focusedNode)];

                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>")

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>")
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "' ";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);
                                }

                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "' ";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }

                            // Display emotion subclass
                        } else if (EMOTION_CATEGORIES.indexOf(focusedNode) != -1) {
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");
                        } else {
                            var propertyValue = Object.values(labelInfo);
                            var relatedEmotion;
                            if(propertyValue[1] == ""){
                                relatedEmotion  = "None"
                            } else{
                                relatedEmotion = propertyValue[1];
                            }
                            const wordPolarity = ["Neutral", "Positive", "Negative", "Mixed"];

                            $("#description")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Part Of" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[0] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: cornflowerblue'>" + "Related" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + relatedEmotion + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #3e8e41'>" + "Part of Speech" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[2] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #a7a82e'>" + "Intensity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[3] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color:#944b4b;'>" + "Word Meanings" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[4] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background:#665d91;'>" + "Polarity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + wordPolarity[propertyValue[5]] + "</span><br>");

                        }

                        // Iterate through all text nodes, select text nodes directly connected to the focused node
                        d3.select("#canvas").selectAll(".texts text").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Focused node
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            // Display nodes directly connected to the current focused node
                            for (var i = 0; i < links.length; i++) {
                                if (links[i].source.id == focusedNode && links[i].target.id == d.id) {
                                    if (switcher[links[i].target.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                                if (links[i].target.id  == focusedNode && links[i].source.id  == d.id) {
                                    if (switcher[links[i].source.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                            }
                            return addDarkModeClass + "inactive";
                        });

                        // 显示与当前聚焦节点直接相连的边
                        d3.select("#canvas").selectAll(".links line").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // console.log(d.source.id);
                            // console.log(focusedNode.name);
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass + 'focus';
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // 只显示之间相连的关系名
                        d3.select("#canvas").selectAll('.lineTexts text').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass;
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // When mouse hovers over text node, hide all Nodes nodes
                        d3.select('#canvas').selectAll('.nodes circle').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            for (var i = 0; i < links.length; i++) {
                                if (links[i]['source'].id == focusedNode && links[i]['target'].id == d.id) {
                                    return addDarkModeClass;
                                }
                                if (links[i]['target'].id == focusedNode && links[i]['source'].id == d.id) {
                                    return addDarkModeClass;
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });
                    }
                });

                // When mouse is no longer focused on a selected node
                $('#canvas').on('mouseleave', '.texts text', function(event) {
                    if (!isDragging) {
                        // Hide all edge relationships
                        $(".lineTexts text").addClass("inactive");
                        $(".links line").removeClass("focus");
                        // $(".links line").removeClass("inactive");
                        $(".nodes circle").removeClass("inactive");
                        // Display all text nodes with label Off, if switch is off and belongs to current label, set to active
                        d3.select('#canvas').selectAll(".texts text").attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        // Select edges connected to nodes with label switch on
                        d3.select("#canvas").selectAll('.links line').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + "inactive";
                            }
                        });
                        // Display all text nodes with label on
                        d3.select('#canvas').selectAll('.nodes node').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Currently selected type entity display
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                    }
                });
            });
        });
    });
</script>
</html>