<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Emotion Net Mini</title>
    <meta name="keywords" content="KG Multimodal emotion net" />
    <meta name="author" content="sheepcore" />
    <link rel="shortcut icon" href="assets/images/icon/project-icon.svg">
    <!--  link outer css stylesheet  -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap-theme.css">
    <!--    link framework css stylesheet-->
    <link rel="stylesheet" href="css/framework.css">
    <!--    link canvas css stylesheet  -->
    <link rel="stylesheet" href="css/canvas.css">
    <!--    link imageContainer css stylesheet-->
    <link rel="stylesheet" href="css/imageContainer.css">
    
    <!--link outer js lib-->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
</head>
<body>
<!-- Title Section -->
<div style="height: 5em">
    <h1 id="emotionNetName">Emotion Net Mini</h1>
    <div id='darkMode' style="display:inline-block;">
        <span style="position: absolute; right: 30px; margin-bottom: 25px; margin-top: 15px;"><strong>dark mode</strong></span>
    </div>
    <a href="https://github.com/CoreSheep/emotion-net" target="_blank" class="github-icon" style="position: absolute; right: 125px; margin-top: 33px; text-decoration: none;" title="View on GitHub">
        <svg height="20" viewBox="0 0 16 16" version="1.1" width="20" aria-hidden="true" style="fill: #333; vertical-align: middle;" class="github-icon-svg">
            <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
    </a>
</div>

<!-- Main container with grid layout -->
<div class="container-fluid main-container">
    <!-- Row 1: Canvas and Controls Layout -->
    <div class="row canvas-controls-row">
        <!-- Left Column (col-2) - Mode, Search, Label, and Switches -->
        <div class="col-xs-12 col-sm-12 col-md-2 left-controls">
            <!-- Display Mode (Circle or Text) -->
            <div id="mode" class="control-group">
                <label class="control-label">Display Mode</label>
                <div class="button-group">
                    <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; flex: 0 0 50%;">Circles</span>
                    <span style="border-top-left-radius: 0;border-bottom-left-radius: 0; flex: 0 0 50%; border-left: none;">Texts</span>
                </div>
            </div>

            <!-- Search Box -->
            <div id="search" class="control-group">
                <label class="control-label">Search</label>
                <input type="text" autocomplete="off" class="form-control">
            </div>

            <!-- Legend and Node Categories Row -->
            <div class="legend-categories-wrapper" style="display: flex; gap: 8px; margin-bottom: 10px; align-items: flex-start; padding-top: 20px;">
                <!-- Legend Section -->
                <div style="flex: 1;">
                    <div id="label" class="control-group" style="margin-bottom: 8px; border-bottom: none;">
                        <label class="control-label">Legend</label>
                        <div id="label-content"></div>
                    </div>
                </div>

                <!-- Switches Container (Node Categories) -->
                <div id="switches-container" class="switches-container" style="flex: 1; padding-top: 0;">
                <label class="control-label" style="text-align: center; margin-bottom: 8px;">Categories</label>

                <!-- Center Toggle Switch -->
                <div id="switcher1" class="switcher-group">
                    <div class="button-group" style="flex: 1;">
                        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 8px; padding-left: 8px; font-size: 10px;">On</span>
                        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -9px; font-size: 10px;">Off</span>
                    </div>
                </div>

                <!-- Category Toggle Switch -->
                <div id="switcher2" class="switcher-group">
                    <div class="button-group" style="flex: 1;">
                        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 8px; padding-left: 8px; font-size: 10px;">On</span>
                        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -9px; font-size: 10px;">Off</span>
                    </div>
                </div>

                <!-- Emotion Toggle Switch -->
                <div id="switcher3" class="switcher-group">
                    <div class="button-group" style="flex: 1;">
                        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 8px; padding-left: 8px; font-size: 10px;">On</span>
                        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -9px; font-size: 10px;">Off</span>
                    </div>
                </div>

                <!-- Word Toggle Switch -->
                <div id="switcher4" class="switcher-group">
                    <div class="button-group" style="flex: 1;">
                        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 8px; padding-left: 8px; font-size: 10px;">On</span>
                        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -9px; font-size: 10px;">Off</span>
                    </div>
                </div>
                </div>
            </div>

            <!-- Tips Section (Full Width) -->
            <div id="tooltips" class="tooltips-visible tooltips-section" style="width: 100%; margin-top: 10px;">
                <span style="font-size: 12px; color: rgba(22,116,31,0.78); font-weight: bold">Tips:</span><br>
                <span style="font-size: 11px;">1. Click Circle/Text button to switch display modes</span><br>
                <span style="font-size: 11px;">2. Click On/Off to show or hide node categories</span><br>
                <span style="font-size: 11px;">3. Drag nodes to auto-adjust layout</span><br>
                <span style="font-size: 11px;">4. Hover over nodes to see emotion</span><br>
                <span style="font-size: 11px;">5. Scroll to zoom in/out</span><br>
                <span style="font-size: 11px;">6. Drag empty areas to move graph</span><br>
            </div>
        </div>

        <!-- Center Column (col-8) - Canvas -->
        <div class="col-xs-12 col-sm-12 col-md-8 canvas-column">
            <div class="canvas-wrapper">
                <svg width="880" height="580" id="canvas" class="emotion-canvas"></svg>
            </div>
        </div>

        <!-- Right Column (col-2) - Property Info -->
        <div class="col-xs-12 col-sm-12 col-md-2 right-property">
            <div id="labelProperty" class="property-panel">
                <h4>Word Property</h4>
                <div id="subclass"></div>
                <div id="description"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="faceImageContainer1"></u>
                    </div>
                </div>
                <div id="tag1"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="faceImageContainer2"></u>
                    </div>
                </div>
                <div id="tag2"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="faceImageContainer3"></u>
                    </div>
                </div>
                <div id="tag3"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="emojiImageContainer"></u>
                    </div>
                </div>
                <div id="tag4"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="animalImageContainer"></u>
                    </div>
                </div>
                <div id="tag5"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="animalImageContainer2"></u>
                    </div>
                </div>
                <div id="tag6"></div>
                <div class="showImage">
                    <div class="imageContent">
                        <u id="animalImageContainer3"></u>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="project-footer">
    <span style="font-size: small;color: rgba(123,135,138,0.75); font-family: 'SimSun';">designed by Jiufeng Li</span>
</div>
</body>
<!-- D3.js library -->
<script src="https://d3js.org/d3.v5.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        // Tooltips visibility management
        window.tooltipsVisible = true;

        // Auto-show tooltips when in Circle mode (no text visible)
        window.updateTooltipsAutoDisplay = function() {
            var isCircleMode = $('.texts text:visible').length === 0;
            if (isCircleMode && !window.tooltipsVisible) {
                window.tooltipsVisible = true;
                $("#tooltips").removeClass("tooltips-hidden").addClass("tooltips-visible");
                $("#tooltips-toggle").html("ðŸ’¡ Tips");
            }
        };

        // Toggle tooltips visibility
        $("#tooltips-toggle").on("click", function() {
            window.tooltipsVisible = !window.tooltipsVisible;
            if (window.tooltipsVisible) {
                $("#tooltips").removeClass("tooltips-hidden").addClass("tooltips-visible");
                $(this).html("ðŸ’¡ Tips");
            } else {
                $("#tooltips").removeClass("tooltips-visible").addClass("tooltips-hidden");
                $(this).html("ðŸ’¡ Show Tips");
            }
        });

        // Make canvas responsive to window size changes
        var canvasElement = document.getElementById("canvas");
        var canvasWidth, canvasHeight;

        function resizeCanvas() {
            var windowWidth = window.innerWidth;
            if (windowWidth <= 480) {
                // Mobile devices
                canvasWidth = Math.min(windowWidth - 20, 350);
                canvasHeight = 400;
                canvasElement.style.marginLeft = "10px";
            } else if (windowWidth <= 768) {
                // Tablets
                canvasWidth = Math.min(windowWidth - 40, 600);
                canvasHeight = 500;
                canvasElement.style.marginLeft = "20px";
            } else {
                // Desktop
                canvasWidth = 880;
                canvasHeight = 580;
                canvasElement.style.marginLeft = "40px";
            }
            canvasElement.setAttribute("width", canvasWidth);
            canvasElement.setAttribute("height", canvasHeight);
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Select the current canvas object
        var canvas = d3.select("#canvas");
        var width = canvasElement.getAttribute("width");
        var height = canvasElement.getAttribute("height");

        const EMOTION_NAMES = ['Center', 'Emotion', 'Category', 'Word']; //, 'Word'
        const RELATION_NAMES = {"SUBCLASS_OF": "Subclass", "PART_OF": "Part of", "RELATED_TO": "Related"};
        const CIRCLE_SIZE = [25, 16, 12, 10];
        const LABEL_TEXT_FONT_SIZE = [20, 16, 10, 8];
        const EMOTION_CATEGORIES = ["å¿«ä¹", "å®‰å¿ƒ", "å°Šæ•¬", "èµžæ‰¬", "ç›¸ä¿¡", "å–œçˆ±", "ç¥æ„¿", "æ„¤æ€’", "æ‚²ä¼¤", "å¤±æœ›", "ç–š",
            "æ€", "æ…Œ", "ææƒ§", "ç¾ž", "çƒ¦é—·", "æ†Žæ¶", "è´¬è´£", "å¦’å¿Œ", "æ€€ç–‘", "æƒŠå¥‡"];

        const EMOTIONS = ["ä¹", "å¥½", "æ€’", "å“€", "æƒ§", "æ¶", "æƒŠ"];
        
        // Bilingual emotion name mapping
        const EMOTION_DISPLAY_NAMES = {
            "è¡¨æƒ…": "è¡¨æƒ… (Emotion)",
            "ä¹": "ä¹ (Joy)",
            "å¥½": "å¥½ (Good)",
            "æ€’": "æ€’ (Anger)",
            "å“€": "å“€ (Sadness)",
            "æƒ§": "æƒ§ (Fear)",
            "æ¶": "æ¶ (Disgust)",
            "æƒŠ": "æƒŠ (Surprise)"
        };
        
        // Function to get display name
        function getDisplayName(name) {
            return EMOTION_DISPLAY_NAMES[name] || name;
        }

        // Define node colors for different hierarchy levels
        const NODE_COLORS = ['rgba(160,134,48,0.98)', 'rgba(142,74,74,0.98)', 'rgba(66,131,80,0.96)', "rgba(102,93,145,0.96)"];

        // Append legend items to the label container
        for (var i = 0; i < EMOTION_NAMES.length; i++) {
            $('#label-content').append("<div><span style='background-color:" + NODE_COLORS[i] + "'></span>" + EMOTION_NAMES[i] +"</div>")
        }

        // Configure repulsive force between nodes (prevents overlap)
        // Negative strength creates repulsion; distanceMax defines the reach
        var forceManyBody = d3.forceManyBody()
            .strength(-46)   // Small repulsive force
            .distanceMin(1) // Minimum distance threshold
            .distanceMax(1500); // Maximum distance for force effect

        // Configure attractive force between linked nodes
        var forceLink = d3.forceLink()
            .distance(50) // Desired distance between connected nodes
            .iterations(4);

        // Configure collision force to prevent node overlap
        var forceCollide =  d3.forceCollide()
            .radius(20) // Collision radius
            .iterations(4); // Rigidity of collision constraint

        var forceRadial = d3.forceRadial(25);
        var forceCenter = d3.forceCenter(width / 2, height / 2);

        var nodes, links, node, link, lineText, text;

        // Load emotion network data and initialize visualization
        d3.json("./assets/mini-graph/mini-emotion-net.json").then(function (data) {
            nodes = data.nodes;
            links = data.links;

            // Bind link data and create line elements
            link = canvas.append('g')
                .attr("class", "links")
                .selectAll("line")
                .data(links)
                .enter()
                .append("line")
                .attr('stroke-width', d => 1)
                .attr('class', 'darkMode');

            // Create text labels for relationships between nodes
            lineText = canvas.append('g')
                .attr("class", "lineTexts")
                .selectAll("text")
                .data(links)
                .enter()
                .append("text")
                .attr("class", "darkMode inactive")
                .text(d => RELATION_NAMES[d.relation]);

            // Configure and initialize force simulation
            var simulation = d3.forceSimulation()
                .nodes(nodes)
                .velocityDecay(0.6)
                .force("link", forceLink.links(links).id(d => d.id))
                .force("charge", forceManyBody)
                .force("collide", forceCollide)
                .force("center", forceCenter);

            // Bind node data and create circle elements
            node = canvas.append('g')
                .attr('class', 'nodes')
                .selectAll('circle')
                .data(nodes)
                .enter()
                .append('circle')
                .attr("r", d => CIRCLE_SIZE[d.group - 1])
                .attr('fill', d => NODE_COLORS[d.group - 1])
                .attr('stroke', 'none')
                .attr('name', d => d.id)
                .attr('class', 'darkMode')
                .call(drag(simulation)); // Enable dragging for nodes

            // Create text labels for nodes
            // Two display modes: nodes can be shown as circles or text labels
            text = canvas.append('g')
                .attr("class", "texts")
                .selectAll("text")
                .data(nodes)
                .enter()
                .append("text")
                .attr("display", "none")
                .attr("font-size", d => LABEL_TEXT_FONT_SIZE[d.group - 1])
                .attr("fill", d => NODE_COLORS[d.group - 1])
                .attr('name', d => d.id)
                .text(d => getDisplayName(d.id))
                .attr('text-anchor', 'middle')
                .call(drag(simulation)); // Enable dragging for text labels

            // Add tooltips to nodes on hover
            node.append('title').text(d => getDisplayName(d.id));

            // $("#canvas").on("mouseenter", function (e) {
            //     d3.select("#canvas").attr("class",  "showBorder");
            // });
            //
            // $("#canvas").on("mouseleave", function (e) {
            //     d3.select("#canvas").removeClass("showBorder");
            // });


            // Register tick event handler for animation loop
            simulation.on("tick", ticked);

            // Canvas boundary constraints
            var PositionBias = 350;
            scaleLinear = d3.scaleLinear([0, 10], d3.range(30));
            var PositionFactor = Math.floor(Math.random() * 10 + 1);
            var PositionJustify = scaleLinear(PositionFactor);

            // Constrain node X position to stay within canvas boundaries
            function ensureXInCanvas(x) {
                var alterX = x;
                if (x > width + PositionBias) alterX = width - PositionJustify;
                if (x < 0 - PositionBias) alterX = PositionJustify;
                return alterX;
            }

            // Constrain node Y position to stay within canvas boundaries
            function ensureYInCanvas(y) {
                var alterY = y;
                if (y > height + PositionBias) alterY = height - PositionJustify;
                if (y < 0 - PositionBias) alterY = PositionJustify;
                return alterY;
            }

            // Update element positions on each simulation tick
            function ticked() {
                // Update link endpoints
                link
                    .attr("x1", d => ensureXInCanvas(d.source.x))
                    .attr("y1", d => ensureYInCanvas(d.source.y))
                    .attr("x2", d => ensureXInCanvas(d.target.x))
                    .attr("y2", d => ensureYInCanvas(d.target.y));

                // Update node positions
                node
                    .attr("cx", d => ensureXInCanvas(d.x))
                    .attr("cy", d => ensureYInCanvas(d.y));

                // Update relationship label positions (midpoint of links)
                lineText
                    .attr("dx", d => (d.source.x + d.target.x) / 2)
                    .attr("dy", d => (d.source.y + d.target.y) / 2);

                // Update text label positions
                text
                    .attr("dx", d => ensureXInCanvas(d.x))
                    .attr("dy", d => ensureYInCanvas(d.y));
            }

            // Handle node dragging interactions
            var isDragging = false;
            function drag(simulation) {
                // Drag start event handler
                function dragstarted(d) {
                    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                    isDragging = true;
                }

                // Drag in progress event handler
                function dragged(d) {
                    d.fx = d3.event.x;
                    d.fy = d3.event.y;
                }

                // Drag end event handler
                function dragended(d) {
                    if (!d3.event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                    isDragging = false;
                }
                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }

            // Enable zooming and panning on the canvas
            canvas.call(d3.zoom()
                .scaleExtent([1 / 4, 4])
                .on("zoom", zoomed));

            // Update element transforms during zoom/pan operations
            function zoomed() {
                link.attr("transform", d3.event.transform);
                node.attr("transform", d3.event.transform);
                text.attr("transform", d3.event.transform);
                lineText.attr('transform', d3.event.transform);
            }

            // Toggle display mode between circles and text labels
            $('#mode .button-group span').click(function(event) {
                // Update active state
                $('#mode .button-group span').removeClass('active');
                $(this).addClass('active');

                if ($(this).text() == 'Circles') {
                    // Show circle nodes, hide text labels
                    $('.texts text').hide();
                    $('.nodes circle').show();

                    // Auto-show tooltips in circle mode
                    setTimeout(function() {
                        if (typeof updateTooltipsAutoDisplay === 'function') {
                            updateTooltipsAutoDisplay();
                        }
                    }, 100);
                }
                else {
                    // Show text labels, hide circle nodes
                    $('.texts text').show();
                    $('.nodes circle').hide();
                }
            });

            // Node category visibility switcher array
            // Index: 1=Center, 2=Category, 3=Emotion, 4=Word
            // true = show, false = hide
            var switcher = [NaN, true, true, true, true];

            // Handle Center node category toggle
            $('#switcher1 .button-group span').click(function() {
                // Update active button state
                $('#switcher1 .button-group span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                if ($(this).text() == 'On') {
                    // Show Center nodes and their connected edges
                    switcher[1] = true;

                    // Update node visibility
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });

                    // Update edge visibility
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    // Update text label visibility
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });
                }
                else {
                    // Hide Center nodes and their connected edges
                    switcher[1] = false;

                    // Update node visibility
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });

                    // Update edge visibility
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + "inactive";
                        }
                    });

                    // Update text label visibility
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // Handle Category node category toggle
            $('#switcher2 .button-group span').click(function() {
                $('#switcher2 .button-group span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                if ($(this).text() == 'On') {
                    // Show Category nodes and their connected edges
                    switcher[2] = true;

                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                else {
                    // Hide Category nodes and their connected edges
                    switcher[2] = false;

                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // Handle Emotion node category toggle
            $('#switcher3 .button-group span').click(function() {
                $('#switcher3 .button-group span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                if ($(this).text() == 'On') {
                    // Show Emotion nodes and their connected edges
                    switcher[3] = true;

                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                else {
                    // Hide Emotion nodes and their connected edges
                    switcher[3] = false;

                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // Handle Word node category toggle
            $('#switcher4 .button-group span').click(function() {
                $('#switcher4 .button-group span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                if ($(this).text() == 'On') {
                    // Show Word nodes and their connected edges
                    switcher[4] = true;

                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                else {
                    // Hide Word nodes and their connected edges
                    switcher[4] = false;

                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d) {
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            var labelInfoAll;
            const imageNums = 10;
            const IMAGE_CATEGORIES = ['HA1_P', 'GD1_P', 'AN1_P', 'SA1_P', 'FE1_P', 'DI1_P', 'SU1_P'];
            const ANIMAL_EMOTIONS_NUMS = 3;
            const IMAGE_CATEGORIES_ANIMALS = ['happy_0', 'good_0', 'angry_0', 'sad_0', 'fear_0',
                'disgust_0', 'surprise_0'];


            // Dark mode state management
            var DARKMODE = true;

            // Load emotion label information and initialize dark mode
            d3.json("./assets/mini-graph/mini-label-info.json").then(function (data) {
                labelInfoAll = data;

                // Apply dark mode on page load
                $("body").addClass("darkMode");
                $("#emotionNetName").addClass("darkMode");
                $("#label").addClass("darkMode");
                $("#mode .button-group span").addClass("darkMode");
                $("#darkMode span").addClass("darkMode").html("<strong>light mode</strong>");
                $("#switcher1 .button-group span").addClass("darkMode");
                $("#switcher2 .button-group span").addClass("darkMode");
                $("#switcher3 .button-group span").addClass("darkMode");
                $("#switcher4 .button-group span").addClass("darkMode");
                $("#tooltips").addClass("darkMode");
                $("#search input").addClass("darkMode");
                $("#canvas").addClass("darkMode");

                // Handle dark mode toggle
                $("#darkMode").on("click", function (e) {
                    DARKMODE = !DARKMODE;
                    if (DARKMODE) {
                        // Enable dark mode
                        $("body").addClass("darkMode");
                        $("#emotionNetName").addClass("darkMode");
                        $("#label").addClass("darkMode");
                        $("#mode .button-group span").addClass("darkMode");
                        $("#darkMode span").addClass("darkMode").html("<strong>light mode</strong>");
                        $("#switcher1 .button-group span").addClass("darkMode");
                        $("#switcher2 .button-group span").addClass("darkMode");
                        $("#switcher3 .button-group span").addClass("darkMode");
                        $("#switcher4 .button-group span").addClass("darkMode");
                        $("#tooltips").addClass("darkMode");
                        $("#search input").addClass("darkMode");
                        $("#canvas").addClass("darkMode");

                        var addDarkModeClass = 'darkMode ';
                        d3.select('#canvas .links').selectAll('line').attr('class', function(d) {
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive';
                            }
                        });
                        d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        d3.select('#canvas .lineTexts').selectAll('text').attr('class', 'darkMode inactive');
                    } else {
                        // Disable dark mode (light mode)
                        $("body").removeClass("darkMode");
                        $("#emotionNetName").removeClass("darkMode");
                        $("#label").removeClass("darkMode");
                        $("#mode .button-group span").removeClass("darkMode");
                        $("#darkMode span").removeClass("darkMode").html("<strong>dark mode</strong>");
                        $("#switcher1 .button-group span").removeClass("darkMode");
                        $("#switcher2 .button-group span").removeClass("darkMode");
                        $("#switcher3 .button-group span").removeClass("darkMode");
                        $("#switcher4 .button-group span").removeClass("darkMode");
                        $("#tooltips").removeClass("darkMode");
                        $("#search input").removeClass("darkMode");
                        $("#canvas").removeClass("darkMode");
                        $(".links line").removeClass("darkMode");

                        var linksClassList = d3.select('#canvas .links').selectAll('line').attr('class').replace("darkMode", '');
                        d3.select('#canvas .links').selectAll('line').attr('class', function(d) {
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return linksClassList;
                            } else {
                                return linksClassList + 'inactive';
                            }
                        });
                        var nodesClassList = d3.select('#canvas .nodes').selectAll('circle').attr('class').replace("darkMode", '');
                        d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d) {
                            if (switcher[d.group]) {
                                return nodesClassList;
                            } else {
                                return nodesClassList + 'inactive'
                            }
                        });
                        var textClassList = d3.select('#canvas .lineTexts').selectAll('text').attr('class').replace("darkMode", '');
                        d3.select('#canvas .lineTexts').selectAll('text').attr('class', textClassList);
                    }
                });

                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                // Handle node hover events to display property information
                $("#canvas").on("mouseenter", ".nodes circle", function (e) {
                    if (!isDragging) {
                        // Get the name of the hovered node
                        var focusedNode = $(this).attr("name");

                        // Clear all property display containers
                        $("#subclass").empty();
                        $("#description").empty();
                        $("#faceImageContainer1").empty();
                        $("#faceImageContainer2").empty();
                        $("#faceImageContainer3").empty();
                        $("#emojiImageContainer").empty();
                        $("#animalImageContainer").empty();
                        $("#animalImageContainer2").empty();
                        $("#animalImageContainer3").empty();
                        $("#tag1").empty();
                        $("#tag2").empty();
                        $("#tag3").empty();
                        $("#tag4").empty();
                        $("#tag5").empty();
                        $("#tag6").empty();

                        // Update property panel header with node name and color
                        $("#labelProperty h4").css("color", $(this).attr("fill")).text(getDisplayName($(this).attr("name")));

                        // Add hover effects to image items (lift and glow)
                        $('#faceImageContainer1').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });

                        $('#faceImageContainer1').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#faceImageContainer2').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#faceImageContainer2').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#faceImageContainer3').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#faceImageContainer3').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#emojiImageContainer').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#emojiImageContainer').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer2').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer2').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer3').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer3').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        var labelInfo = labelInfoAll[focusedNode];
                        // Display emotions by category (subcategory emotion words have no images)
                        // Display emotion category properties
                        // $('.imageContent ul li').on('mouseenter', function () {
                        //     $(this).css('border', '1px wihtesomke solid')
                        // });
                        // $('.imageContent ul li').on('mousemove', '.imageContent ul li', function () {
                        //     $(this).css('display', 'block')
                        // })

                        if (EMOTIONS.indexOf(focusedNode) != -1 || focusedNode == "è¡¨æƒ…") {
                            // $("#labelProperty").append("image").attr()
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");

                            $("#description")
                                .append("<div><span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Description" + "</span><br></div>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.DESCRIPTION + "</span>");

                            if (focusedNode == "è¡¨æƒ…") {
                                var e;
                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "Human Face Expressions" + "</span><br></div>");

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "Social Media Emojis" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);

                                }
                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "Animal Expressions" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }
                            // Display emotion categories
                            else {
                                var emotionType = IMAGE_CATEGORIES[EMOTIONS.indexOf(focusedNode)];
                                var animalEmotionType = IMAGE_CATEGORIES_ANIMALS[EMOTIONS.indexOf(focusedNode)];

                                $("#description")
                                    .append("<div><span class='label' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "Human Face Expressions" + "</span><br></div>");

                                for (let i = 0; i < imageNums; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + emotionType + (i + 1) + ".png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                var emojiNums = 7;
                                $("#tag1").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "Social Media Emojis" + "</span><br></div>")
                                for (let i = 0; i < emojiNums; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + emotionType + (i+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                var animalEmotionsNum = 3;
                                $("#tag2").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "Animal Expressions" + "</span><br></div>")
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-cat-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-dog-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-hamster-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                            }

                            // Display emotion subcategories
                        } else if (EMOTION_CATEGORIES.indexOf(focusedNode) != -1) {
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");
                        } else {
                            // Display word emotion feature list
                            var propertyValue = Object.values(labelInfo);
                            var relatedEmotion;
                            if(propertyValue[1] == ""){
                                relatedEmotion  = "æ— "
                            } else{
                                relatedEmotion = propertyValue[1];
                            }
                            const wordPolarity = ["Neutral", "Positive", "Negative", "Both"];

                            $("#description")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Belongs to" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[0] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: cornflowerblue'>" + "Related" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + relatedEmotion + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #3e8e41'>" + "Part of Speech" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[2] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #a7a82e'>" + "Intensity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[3] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color:#944b4b;'>" + "Meanings" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[4] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background:#665d91;'>" + "Polarity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + wordPolarity[propertyValue[5]] + "</span><br>");

                        }

                        // Iterate through all nodes to find nodes directly connected to focused node
                        d3.select("#canvas").selectAll(".nodes circle").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Focused node
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            // Show nodes directly connected to focused node with enabled switcher
                            for (var i = 0; i < links.length; i++) {
                                if (links[i].source.id == focusedNode && links[i].target.id == d.id) {
                                    if (switcher[links[i].target.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                                if (links[i].target.id  == focusedNode && links[i].source.id  == d.id) {
                                    if (switcher[links[i].source.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                            }
                            return addDarkModeClass + "inactive";
                        });

                        // Show edges directly connected to focused node
                        d3.select("#canvas").selectAll(".links line").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // console.log(d.source.id);
                            // console.log(focusedNode.name);
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass + 'focus';
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // Show only relationship names between connected nodes
                        d3.select("#canvas").selectAll('.lineTexts text').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass;
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            } else {
                                return addDarkModeClass + "inactive";
                            }
                        });

                        // Hide all text nodes when hovering over circle nodes
                        d3.select('#canvas').selectAll('.texts text').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            for (var i = 0; i < links.length; i++) {
                                if (links[i]['source'].id == focusedNode && links[i]['target'].id == d.id) {
                                    return addDarkModeClass;
                                }
                                if (links[i]['target'].id == focusedNode && links[i]['source'].id == d.id) {
                                    return addDarkModeClass;
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });
                    }
                });

                // When mouse leaves focused node
                $('#canvas').on('mouseleave', '.nodes circle', function(event) {
                    if (!isDragging) {
                        // Hide all edge relationships
                        $(".lineTexts text").addClass("inactive");
                        // Remove focus effect
                        $(".links line").removeClass("focus");

                        // $(".links line").removeClass("inactive");

                        // Show all nodes with labels on; if switch is off, set as inactive
                        d3.select('#canvas').selectAll(".nodes circle").attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Show if group is 1 and switch label is on
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        // Select edges connected to nodes with label switch on
                        d3.select("#canvas").selectAll('.links line').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Show edges where both endpoints belong to same category and label switch is on
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + "inactive";
                            }
                        });
                        // Show all text nodes with label switch on
                        d3.select('#canvas').selectAll('.texts text').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Currently selected entity type display
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                    }
                });

                $("#canvas").on("mouseenter", ".texts text", function (e) {
                    if (!isDragging) {
                        // Get focused node name for node visibility control
                        var focusedNode = $(this).attr("name");
                        // Determine display mode
                        // Determine display mode
                        $("#subclass").empty();
                        $("#description").empty();
                        $("#faceImageContainer1").empty();
                        $("#faceImageContainer2").empty();
                        $("#faceImageContainer3").empty();
                        $("#emojiImageContainer").empty();
                        $("#animalImageContainer").empty();
                        $("#animalImageContainer2").empty();
                        $("#animalImageContainer3").empty();
                        $("#tag1").empty();
                        $("#tag2").empty();
                        $("#tag3").empty();
                        $("#tag4").empty();
                        $("#tag5").empty();
                        $("#tag6").empty();

                        $("#labelProperty h4").css("color", $(this).attr("fill")).text(getDisplayName($(this).attr("name")));
                        var labelInfo = labelInfoAll[focusedNode];
                        // Display emotions by category (subcategory emotion words have no images)
                        // Display emotion category properties
                        if (EMOTIONS.indexOf(focusedNode) != -1 || focusedNode == "è¡¨æƒ…") {
                            // $("#labelProperty").append("image").attr()
                            // Display subcategory emotion information
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");

                            // Add description for each emotion category
                            $("#description")
                                .append("<div><span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Description" + "</span><br></div>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.DESCRIPTION + "</span>");

                            if (focusedNode == "è¡¨æƒ…") {
                                var e;

                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "Human Face Expressions" + "</span><br></div>")

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "Social Media Emojis" + "</span><br></div>")
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);
                                }

                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "Animal Expressions" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }

                            // Display emotion categories
                            else {
                                var emotionType = IMAGE_CATEGORIES[EMOTIONS.indexOf(focusedNode)];
                                var animalEmotionType = IMAGE_CATEGORIES_ANIMALS[EMOTIONS.indexOf(focusedNode)];

                                $("#description")
                                    .append("<div><span class='label' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "Human Face Expressions" + "</span><br></div>");

                                for (let i = 0; i < imageNums; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + emotionType + (i + 1) + ".png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                const emojiNums = 7;
                                $("#tag1").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "Social Media Emojis" + "</span><br></div>")
                                for (let i = 0; i < emojiNums; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + emotionType + (i+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                var animalEmotionsNum = 3;
                                $("#tag2").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "Animal Expressions" + "</span><br></div>")
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-cat-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-dog-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-hamster-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                            }

                            // Display emotion subcategories
                        } else if (EMOTION_CATEGORIES.indexOf(focusedNode) != -1) {
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Subclass" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");
                        } else {
                            var propertyValue = Object.values(labelInfo);
                            var relatedEmotion;
                            if(propertyValue[1] == ""){
                                relatedEmotion  = "æ— "
                            } else{
                                relatedEmotion = propertyValue[1];
                            }
                            const wordPolarity = ["Neutral", "Positive", "Negative", "Both"];

                            $("#description")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "Belongs to" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[0] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: cornflowerblue'>" + "Related" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + relatedEmotion + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #3e8e41'>" + "Part of Speech" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[2] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #a7a82e'>" + "Intensity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[3] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color:#944b4b;'>" + "Meanings" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[4] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background:#665d91;'>" + "Polarity" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + wordPolarity[propertyValue[5]] + "</span><br>");

                        }

                        // Iterate through text nodes to find those connected to focused node
                        d3.select("#canvas").selectAll(".texts text").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Focused node
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            // Show nodes directly connected to focused node
                            for (var i = 0; i < links.length; i++) {
                                if (links[i].source.id == focusedNode && links[i].target.id == d.id) {
                                    if (switcher[links[i].target.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                                if (links[i].target.id  == focusedNode && links[i].source.id  == d.id) {
                                    if (switcher[links[i].source.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                            }
                            return addDarkModeClass + "inactive";
                        });

                        // Show edges directly connected to focused node
                        d3.select("#canvas").selectAll(".links line").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // console.log(d.source.id);
                            // console.log(focusedNode.name);
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass + 'focus';
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // Show only relationship names between connected nodes
                        d3.select("#canvas").selectAll('.lineTexts text').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass;
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // Hide all circle nodes when hovering over text nodes
                        d3.select('#canvas').selectAll('.nodes circle').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            for (var i = 0; i < links.length; i++) {
                                if (links[i]['source'].id == focusedNode && links[i]['target'].id == d.id) {
                                    return addDarkModeClass;
                                }
                                if (links[i]['target'].id == focusedNode && links[i]['source'].id == d.id) {
                                    return addDarkModeClass;
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });
                    }
                });

                // When mouse leaves focused text node
                $('#canvas').on('mouseleave', '.texts text', function(event) {
                    if (!isDragging) {
                        // Hide all edge relationships
                        $(".lineTexts text").addClass("inactive");
                        $(".links line").removeClass("focus");
                        // $(".links line").removeClass("inactive");
                        $(".nodes circle").removeClass("inactive");
                        // Show all text nodes with off labels; if switch is off and belongs to current label, set as active
                        d3.select('#canvas').selectAll(".texts text").attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        // Select edges connected to nodes with label switch on
                        d3.select("#canvas").selectAll('.links line').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + "inactive";
                            }
                        });
                        // Show all text nodes with label switch on
                        d3.select('#canvas').selectAll('.nodes node').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // Currently selected entity type display
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                    }
                });
            });
        });
    });
</script>
</html>