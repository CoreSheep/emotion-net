<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Emotion Net Mini</title>
    <meta name="keywords" content="KG Multimodal emotion net" />
    <meta name="author" content="sheepcore" />
    <link rel="shortcut icon" href="assets/images/icon/project-icon.svg">
    <!--  link outer css stylesheet  -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap-theme.css">
    <!--    link framework css stylesheet-->
    <link rel="stylesheet" href="css/framework.css">
    <!--    link canvas css stylesheet  -->
    <link rel="stylesheet" href="css/canvas.css">
    <!--    link imageContainer css stylesheet-->
    <link rel="stylesheet" href="css/imageContainer.css">
    
    <!--link outer js lib-->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
</head>
<body>
<!-- 标题 -->
<div style="height: 5em">
    <h1 id="emotionNetName">Emotion Net Mini</h1>
    <div id='darkMode' style="display:inline-block;">
        <span style="position: absolute; right: 30px; margin-bottom: 25px; margin-top: 15px;"><strong>dark mode</strong></span>
    </div>
    <a href="https://github.com/CoreSheep/emotion-net" target="_blank" class="github-icon" style="position: absolute; right: 125px; margin-top: 17px; text-decoration: none;" title="View on GitHub">
        <svg height="20" viewBox="0 0 16 16" version="1.1" width="20" aria-hidden="true" style="fill: currentColor; vertical-align: middle;">
            <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
    </a>
</div>

<!-- 定义div存放关系图 -->
<!-- NOTE: 父元素采用相对定位，里面的元素采用绝对定位 -->
<div style="text-align: center;position: relative;">
    <svg width="880" height="580" style="position: relative; top: 15px; margin-left: 30px;margin-bottom: -150px" id="canvas"></svg>
    
    <!-- 模式(circle/text) -->
    <div id="mode">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">Circles</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -9px">&nbsp;Texts</span>
    </div>
    
    <!-- 搜索框 -->
    <div id="search">
        <input type="text" autocomplete="off" class="form-control">
    </div>
    
    <!-- 图例 -->
    <div id="label"></div>
    
    
    <!-- 显示切换1On /off -->
    <div id="switcher1">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- 显示切换2On /off-->
    <div id="switcher2">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- 显示切换3On /off-->
    <div id="switcher3">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- 显示切换4On /off-->
    <div id="switcher4">
        <span class="active" style="border-top-right-radius: 0;border-bottom-right-radius: 0; padding-right: 14px">On</span>
        <span style="border-top-left-radius: 0;border-bottom-left-radius: 0;position: relative; left: -10px">Off</span>
    </div>
    
    <!-- 每个结点的信息 -->
    <div id="labelProperty">
        <h4 style="margin-left: -3px">Word Property</h4>
        <div id="subclass"></div>
        <div id="description"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="faceImageContainer1"></u>
            </div>
        </div>
        <div id="tag1"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="faceImageContainer2"></u>
            </div>
        </div>
        <div id="tag2"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="faceImageContainer3"></u>
            </div>
        </div>
        <div id="tag3"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="emojiImageContainer"></u>
            </div>
        </div>
        <div id="tag4"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="animalImageContainer"></u>
            </div>
        </div>
        <div id="tag5"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="animalImageContainer2"></u>
            </div>
        </div>
        <div id="tag6"></div>
        <div class="showImage">
            <div class="imageContent">
                <u id="animalImageContainer3"></u>
            </div>
        </div>
    </div>
    
    <!-- 提示 -->
    <div id="tooltips">
        <span style="font-size: 14px; color: rgba(22,116,31,0.78); font-weight: bold">tooltip:</span><br>
        <small>1.点击Circle/Text按钮可以切换模式哦!</small><br>
        <small>2.点击On/Off按钮可以显示和隐藏节点哦！</small><br>
        <small>3.告诉你一个小魔法：拖拽图中节点，看看<br>&nbsp;&nbsp;它们如何自我调整布局的吧！</small><br>
        <small>4.鼠标悬停可以查看节点属于那种情绪哦！</small><br>
        <small>5.鼠标移入白线框中，在触摸板上向上滑动<br>&nbsp;&nbsp;缩小图谱，向下滑动放大图谱哦！</small><br>
        <small>6.在空白区域点击图谱，可以整体拖动哦！</small><br>
        <small>7.将鼠标移到黄色节点上，看看右侧表情吧！</small><br>
        <small>8.提醒一下，右侧的表情是可以滑动的哦！</small><br>
    </div>
</div>

<div id="project-footer">
    <span style="font-size: small;color: rgba(123,135,138,0.75); font-family: 'SimSun';">designed by Jiufeng Li</span>
</div>
</body>
<!--    <script src="../D3jsConquer/js/d3.v5.min.js"></script>-->
<script src="https://d3js.org/d3.v5.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        // 选出当前画布对象obj
        var canvas = d3.select("#canvas");
        var width = canvas.attr("width");
        var height = canvas.attr("height");
        // console.log(canvas, width, height);

        const EMOTION_NAMES = ['Center', 'Emotion', 'Category', 'WordEmotion']; //, 'WordEmotion'
        const RELATION_NAMES = {"SUBCLASS_OF": "子类", "PART_OF": "属于", "RELATED_TO": "相关"};
        const CIRCLE_SIZE = [25, 16, 12, 10];
        const LABEL_TEXT_FONT_SIZE = [20, 16, 10, 8];
        const EMOTION_CATEGORIES = ["快乐", "安心", "尊敬", "赞扬", "相信", "喜爱", "祝愿", "愤怒", "悲伤", "失望", "疚",
            "思", "慌", "恐惧", "羞", "烦闷", "憎恶", "贬责", "妒忌", "怀疑", "惊奇"];

        const EMOTIONS = ["乐", "好", "怒", "哀", "惧", "恶", "惊"];

        // console.log(CircleSize["EmotionCenter"]);
        const NODE_COLORS = ['rgba(160,134,48,0.98)', 'rgba(142,74,74,0.98)', 'rgba(66,131,80,0.96)', "rgba(102,93,145,0.96)"];

        for (var i = 0; i < EMOTION_NAMES.length; i++) {
            $('#label').append("<div><span style='background-color:" + NODE_COLORS[i] + "'></span>" + EMOTION_NAMES[i] +"</div>")
        }

        // var graph = d3.json("./assets/graph/emotion-net.json", function (data) {

        //定制结点的相互作用力
        var forceManyBody = d3.forceManyBody()
            .strength(-46)   //微小排斥力，定义了力能够将结点push 5px
            .distanceMin(1) //定义一个最小距离，只有大于这个距离才会产生作用力
            .distanceMax(1500);

        //定制边的牵引力
        var forceLink = d3.forceLink()
            .distance(50)
            .iterations(4);

        //定制结点的碰撞力
        var forceCollide =  d3.forceCollide()
            .radius(20)
            .iterations(4);

        var forceRadial = d3.forceRadial(25);

        var forceCenter = d3.forceCenter(width / 2, height / 2);


        //定义碰撞力，防止结点overlapping
        //d3.forceCollide(int radius) 传入一个碰撞半径
        //collide.strength(float strength) 传入一个浮点型碰撞力量，用于计算碰撞轨迹（越大计算越快，开销越大）默认0.7（0~1之间取值）
        //collide.iterations(int count) count值越大，碰撞的刚性(rigidity of the constraint)越强

        // var forceCollide = d3.forceCollide(2);

        var nodes, links, node, link, lineText, text;
        /**
         * promise异步调用机制
         */
        d3.json("./assets/mini-graph/mini-emotion-net.json").then(function (data) {
            // var links = graph.links.map(d => Object.create(d));
            // var nodes = graph.nodes.map(d => Object.create(d));
            nodes = data.nodes;
            links = data.links;

            //update数据
            link = canvas.append('g')
                .attr("class", "links")
                .selectAll("line")
                .data(links)
                .enter()
                .append("line")
                .attr('stroke-width', d => 1);

            //边上的文字（实体之间的关系）
            lineText = canvas.append('g')
                .attr("class", "lineTexts")
                .selectAll("text")
                .data(links)
                .enter()
                .append("text")
                .attr("class", "inactive")
                .text(d => RELATION_NAMES[d.relation]);

            //为节点和边施加各种作用力
            //定制力模拟器，并添加各种定制的力
            var simulation = d3.forceSimulation()
                .nodes(nodes)
                .velocityDecay(0.6)
                .force("link", forceLink.links(links).id(d => d.id))
                .force("charge", forceManyBody)
                // .force("radial", forceRadial)
                .force("collide", forceCollide)
                .force("center", forceCenter);

            // 添加所有的node
            node = canvas.append('g')
                .attr('class', 'nodes')
                .selectAll('circle')
                .data(nodes)
                .enter()
                .append('circle')
                .attr("r", d => CIRCLE_SIZE[d.group - 1])
                .attr('fill', d => NODE_COLORS[d.group - 1])
                .attr('stroke', 'none')    // 没有描边
                .attr('name', d => d.id)
                .call(drag(simulation));   // 拖动结束

            // 文本
            // 两种显示模式，每个结点可以用一个圆或者文本表示
            text = canvas.append('g')
                .attr("class", "texts")
                .selectAll("text")
                .data(nodes)
                .enter()
                .append("text")
                .attr("display", "none")
                .attr("font-size", d => LABEL_TEXT_FONT_SIZE[d.group - 1])
                .attr("fill", d => NODE_COLORS[d.group - 1])
                .attr('name', d => d.id)
                .text(d => d.id)
                .attr('text-anchor', 'middle')
                .call(drag(simulation));

            // 给node加title, 当鼠标悬浮在圆圈上的时候
            node.append('title').text(d => d.id);

            // $("#canvas").on("mouseenter", function (e) {
            //     d3.select("#canvas").attr("class",  "showBorder");
            // });
            //
            // $("#canvas").on("mouseleave", function (e) {
            //     d3.select("#canvas").removeClass("showBorder");
            // });


            simulation.on("tick", ticked);

            var PositionBias = 350;
            scaleLinear = d3.scaleLinear([0, 10], d3.range(30));
            var PositionFactor = Math.floor(Math.random() * 10 + 1);
            var PositionJustify = scaleLinear(PositionFactor);

            function ensureXInCanvas(x) {
                var alterX = x;
                if (x > width + PositionBias) alterX = width - PositionJustify;
                if (x < 0 - PositionBias) alterX = PositionJustify;
                return alterX;
            }

            function ensureYInCanvas(y) {
                var alterY = y;
                if (y > height + PositionBias) alterY = height - PositionJustify;
                if (y < 0 - PositionBias) alterY = PositionJustify;
                return alterY;
            }

            function ticked() {
                //更新每条边的两个端点的当前x,y值
                //每次tick响起，施加力
                //每个节点速度 v = v * (1 - alphaDecay)
                link
                    .attr("x1", d => ensureXInCanvas(d.source.x))
                    .attr("y1", d => ensureYInCanvas(d.source.y))
                    .attr("x2", d => ensureXInCanvas(d.target.x))
                    .attr("y2", d => ensureYInCanvas(d.target.y));

                //更新每个结点的中心坐标值cx, cy
                node
                    .attr("cx", d => ensureXInCanvas(d.x))
                    .attr("cy", d => ensureYInCanvas(d.y));

                lineText
                    .attr("dx", d => (d.source.x + d.target.x) / 2)
                    .attr("dy", d => (d.source.y + d.target.y) / 2);

                text
                    .attr("dx", d => ensureXInCanvas(d.x))
                    .attr("dy", d => ensureYInCanvas(d.y));
            }

            var isDragging = false;
            function drag(simulation) {
                //开始拖拽
                function dragstarted(d) {
                    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                    isDragging = true;
                }

                function dragged(d) {
                    d.fx = d3.event.x;
                    d.fy = d3.event.y;
                }

                function dragended(d) {
                    if (!d3.event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                    isDragging = false;
                }
                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }

            // 处理缩放
            canvas.call(d3.zoom()
                .scaleExtent([1 / 4, 4])
                .on("zoom", zoomed));

            function zoomed() {
                link.attr("transform", d3.event.transform);
                node.attr("transform", d3.event.transform);
                text.attr("transform", d3.event.transform);
                lineText.attr('transform', d3.event.transform);
            }

            //根据模式切换更新显示数据
            $('#mode span').click(function(event) {
                // 把mode里面所有span的active全部去掉
                // 把被点击的这个设置为active
                $('#mode span').removeClass('active');
                $(this).addClass('active');

                if ($(this).text() == 'Circles') {
                    // 隐藏所有文本里面的svg元素
                    // 把node里面的显示出来
                    $('.texts text').hide();
                    $('.nodes circle').show();


                }
                else {
                    $('.texts text').show();
                    $('.nodes circle').hide();
                }
            });

            // 一个label开关数组，true表示打开on, false表示off
            //NaN为数组第一个元素，用于占位
            var switcher = [NaN, true, true, true, true];

            // 处理Center开关点击后的事件
            $('#switcher1 span').click(function() {
                // 把mode里面所有span的active全部去掉
                // 把被点击的这个设置为active
                $('#switcher1 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                //显示中心表情
                if ($(this).text() =='On') {
                    //找到属于当前group的节点，并且显示其相连的边
                    switcher[1] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){

                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive'
                        }
                    });

                    //显示边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });
                }
                //熄灭节点和与之关联的边
                else {
                    switcher[1] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else {
                            return addDarkModeClass + 'inactive'
                        }
                    });

                    //熄灭EmotionCenter连接的边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + "inactive";
                        }
                    });

                    //熄灭EmotionCenter节点的文字
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // 处理Category开关点击后的事件
            $('#switcher2 span').click(function() {
                $('#switcher2 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                //显示EmotionCategory表情类别
                if ($(this).text() =='On') {
                    //找到属于当前group的节点，并且显示其相连的边
                    switcher[2] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                //熄灭节点和与之关联的边
                else {
                    switcher[2] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //熄灭Category连接的边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //熄灭Category节点的文字
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // 处理Emotion开关事件
            $('#switcher3 span').click(function() {
                $('#switcher3 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                //显示Emotions表情细类别
                if ($(this).text() =='On') {
                    //找到属于当前group的节点，并且显示其相连的边
                    switcher[3] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //显示边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                //熄灭Emotion节点和与之关联的边
                else {
                    switcher[3] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //熄灭EmotionCenter连接的边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });


                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // 处理WordEmotion开关事件
            $('#switcher4 span').click(function() {
                // 把mode里面所有span的active全部去掉
                // 把被点击的这个设置为active
                $('#switcher4 span').removeClass('active');
                $(this).addClass('active');
                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }
                //显示中心表情
                if ($(this).text() =='On') {
                    //找到属于当前group的节点，并且显示其相连的边
                    switcher[4] = true;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //显示边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
                //熄灭WordEmotion节点和与之关联的边
                else {
                    switcher[4] = false;
                    d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                        // 当前WordEmotion节点显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //熄灭WordEmotion类节点上连接的边
                    d3.select("#canvas .links").selectAll('line').attr('class', function(d) {
                        if (switcher[d.source.group] && switcher[d.target.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });

                    //熄灭WordEmotion类节点上的文字
                    d3.select('#canvas .texts').selectAll('text').attr('class', function(d){
                        // 当前选中类型实体显示
                        if (switcher[d.group]) {
                            return addDarkModeClass;
                        } else{
                            return addDarkModeClass + 'inactive';
                        }
                    });
                }
            });

            // function loadData(url, callback) {
            //     var rawFile = new XMLHttpRequest();
            //     rawFile.open("GET", url, true);
            //     rawFile.onreadystatechange = function() {
            //         if (rawFile.readyState === 4 && rawFile.status == "200") {
            //             callback(rawFile.responseText);
            //         }
            //     };
            //     rawFile.send(null);
            // }
            //
            // loadData("../../EmotionNet/assets/mini-graph/mini-label-info.json", d =>  labelInfoAll = JSON.parse(d));
            // loadData("../../EmotionNet/assets/mini-graph/mini-emotion-net.json", d =>  emotionNet = JSON.parse(d));

            var labelInfoAll;
            const imageNums = 10;
            const IMAGE_CATEGORIES = ['HA1_P', 'GD1_P', 'AN1_P', 'SA1_P', 'FE1_P', 'DI1_P', 'SU1_P'];
            const ANIMAL_EMOTIONS_NUMS = 3;
            const IMAGE_CATEGORIES_ANIMALS = ['happy_0', 'good_0', 'angry_0', 'sad_0', 'fear_0',
                'disgust_0', 'surprise_0'];


            /**
             * 处理节点聚焦事件
             * handle node's focus event
             */
            var DARKMODE = false;
            // d3.json("./assets/mini-graph/mini-emotion-net.json");
            d3.json("./assets/mini-graph/mini-label-info.json").then(function (data) {
                labelInfoAll = data;

                $("#darkMode").on("click", function (e) {
                    DARKMODE = !DARKMODE;
                    if (DARKMODE) {
                        $("body").addClass("darkMode");
                        $("#emotionNetName").addClass("darkMode");
                        $("#label").addClass("darkMode");
                        $("#mode span").addClass("darkMode");
                        $("#darkMode span").addClass("darkMode").html("<strong>light mode</strong>");
                        $("#switcher1 span").addClass("darkMode");
                        $("#switcher2 span").addClass("darkMode");
                        $("#switcher3 span").addClass("darkMode");
                        $("#switcher4 span").addClass("darkMode");
                        $("#tooltips").addClass("darkMode");
                        $("#search input").addClass("darkMode");
                        $("#canvas").addClass("darkMode");
                        var addDarkModeClass = 'darkMode ';
                        d3.select('#canvas .links').selectAll('line').attr('class', function(d) {
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive';
                            }
                        });
                        d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        d3.select('#canvas .lineTexts').selectAll('text').attr('class', 'darkMode inactive');

                    } else {
                        $("body").removeClass("darkMode");
                        $("#emotionNetName").removeClass("darkMode");
                        $("#label").removeClass("darkMode");
                        $("#mode span").removeClass("darkMode");
                        $("#darkMode span").removeClass("darkMode").html("<strong>dark mode</strong>");
                        $("#switcher1 span").removeClass("darkMode");
                        $("#switcher2 span").removeClass("darkMode");
                        $("#switcher3 span").removeClass("darkMode");
                        $("#switcher4 span").removeClass("darkMode");
                        $("#tooltips").removeClass("darkMode");
                        $("#search input").removeClass("darkMode");
                        $("#canvas").removeClass("darkMode");
                        $(".links line").removeClass("darkMode");

                        var linksClassList = d3.select('#canvas .links').selectAll('line').attr('class').replace("darkMode", '');
                        d3.select('#canvas .links').selectAll('line').attr('class', function(d) {
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return linksClassList;
                            } else {
                                return linksClassList + 'inactive';
                            }
                        });
                        var nodesClassList = d3.select('#canvas .nodes').selectAll('circle').attr('class').replace("darkMode", '');
                        d3.select('#canvas .nodes').selectAll('circle').attr('class', function(d){
                            if (switcher[d.group]) {
                                return nodesClassList;
                            } else{
                                return nodesClassList + 'inactive'
                            }
                        });
                        var textClassList = d3.select('#canvas .lineTexts').selectAll('text').attr('class').replace("darkMode", '');
                        d3.select('#canvas .lineTexts').selectAll('text').attr('class', textClassList);

                    }
                });

                var addDarkModeClass = '';
                if (DARKMODE) {
                    addDarkModeClass = "darkMode ";
                }

                $("#canvas").on("mouseenter", ".nodes circle", function (e) {
                    console.log(addDarkModeClass);
                    if (!isDragging) {
                        //取出当前鼠标进入节点的名字，以便后续进行节点隐藏
                        var focusedNode = $(this).attr("name");
                        $("#subclass").empty();
                        $("#description").empty();
                        $("#faceImageContainer1").empty();
                        $("#faceImageContainer2").empty();
                        $("#faceImageContainer3").empty();
                        $("#emojiImageContainer").empty();
                        $("#animalImageContainer").empty();
                        $("#animalImageContainer2").empty();
                        $("#animalImageContainer3").empty();
                        $("#tag1").empty();
                        $("#tag2").empty();
                        $("#tag3").empty();
                        $("#tag4").empty();
                        $("#tag5").empty();
                        $("#tag6").empty();

                        $("#labelProperty h4").css("color", $(this).attr("fill")).text($(this).attr("name"));

                        //设置图片点击发光和上移特效
                        $('#faceImageContainer1').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });

                        $('#faceImageContainer1').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#faceImageContainer2').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#faceImageContainer2').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#faceImageContainer3').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#faceImageContainer3').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#emojiImageContainer').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#emojiImageContainer').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer2').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer2').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        $('#animalImageContainer3').on("mouseenter", '.imageItem', function () {
                            $(this).css("top", "-6px")
                                .css("transition", "top o.3s")
                                .css("-o-transition", "top .3s")
                                .css( "-ms-transition", "top .3s")
                                .css(  "-moz-transition", "top .3s")
                                .css("-webkit-transition", "top .3s")
                                .addClass("shiningBorder");
                        });
                        $('#animalImageContainer3').on("mouseleave", '.imageItem', function () {
                            $(this).css("top", "0").removeClass("shiningBorder");
                        });

                        var labelInfo = labelInfoAll[focusedNode];
                        //针对不同类别情绪进行分类别展示（小类情绪词没有图片）
                        //对情绪大类的Property展示
                        // $('.imageContent ul li').on('mouseenter', function () {
                        //     $(this).css('border', '1px wihtesomke solid')
                        // });
                        // $('.imageContent ul li').on('mousemove', '.imageContent ul li', function () {
                        //     $(this).css('display', 'block')
                        // })

                        if (EMOTIONS.indexOf(focusedNode) != -1 || focusedNode == "表情") {
                            // $("#labelProperty").append("image").attr()
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "子类" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");

                            $("#description")
                                .append("<div><span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "描述" + "</span><br></div>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.DESCRIPTION + "</span>");

                            if (focusedNode == "表情") {
                                var e;
                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>");

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px; padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);

                                }
                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }
                            // 展示情感大类(emotion category)
                            else {
                                var emotionType = IMAGE_CATEGORIES[EMOTIONS.indexOf(focusedNode)];
                                var animalEmotionType = IMAGE_CATEGORIES_ANIMALS[EMOTIONS.indexOf(focusedNode)];

                                $("#description")
                                    .append("<div><span class='label' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>");

                                for (let i = 0; i < imageNums; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + emotionType + (i + 1) + ".png" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                var emojiNums = 7;
                                $("#tag1").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>")
                                for (let i = 0; i < emojiNums; i++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + emotionType + (i+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                var animalEmotionsNum = 3;
                                $("#tag2").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>")
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-cat-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-dog-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-hamster-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                            }

                            // 展示情感子类(emotions subclass)
                        } else if (EMOTION_CATEGORIES.indexOf(focusedNode) != -1) {
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "子类" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");
                        } else {
                            // 展示情感词属性列表（word emotion feature)
                            var propertyValue = Object.values(labelInfo);
                            var relatedEmotion;
                            if(propertyValue[1] == ""){
                                relatedEmotion  = "无"
                            } else{
                                relatedEmotion = propertyValue[1];
                            }
                            const wordPolarity = ["中性", "褒义", "贬义", "兼有"];

                            $("#description")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "属于" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[0] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: cornflowerblue'>" + "相关" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + relatedEmotion + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #3e8e41'>" + "词性" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[2] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #a7a82e'>" + "强度" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[3] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color:#944b4b;'>" + "词义数" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[4] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background:#665d91;'>" + "极性" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + wordPolarity[propertyValue[5]] + "</span><br>");

                        }

                        //遍历所有结点，选出与聚焦节点直接相连的节点
                        d3.select("#canvas").selectAll(".nodes circle").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            //聚焦节点
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            // 显示与当前聚焦节点直接相连并且对应的switcher开关打开的的节点
                            for (var i = 0; i < links.length; i++) {
                                if (links[i].source.id == focusedNode && links[i].target.id == d.id) {
                                    if (switcher[links[i].target.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                                if (links[i].target.id  == focusedNode && links[i].source.id  == d.id) {
                                    if (switcher[links[i].source.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                            }
                            return addDarkModeClass + "inactive";
                        });

                        // 显示与当前聚焦节点直接相连的边
                        d3.select("#canvas").selectAll(".links line").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // console.log(d.source.id);
                            // console.log(focusedNode.name);
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass + 'focus';
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // 只显示之间相连的关系名
                        d3.select("#canvas").selectAll('.lineTexts text').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass;
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            } else {
                                return addDarkModeClass + "inactive";
                            }
                        });

                        //当鼠标悬停与圆圈节点时，对所有Text文本节点进行隐藏
                        d3.select('#canvas').selectAll('.texts text').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            for (var i = 0; i < links.length; i++) {
                                if (links[i]['source'].id == focusedNode && links[i]['target'].id == d.id) {
                                    return addDarkModeClass;
                                }
                                if (links[i]['target'].id == focusedNode && links[i]['source'].id == d.id) {
                                    return addDarkModeClass;
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });
                    }
                });

                //当鼠标不在聚焦到某个选定的节点时
                $('#canvas').on('mouseleave', '.nodes circle', function(event) {
                    if (!isDragging) {
                        //隐藏所有边的关系
                        $(".lineTexts text").addClass("inactive");
                        //取消focus特效
                        $(".links line").removeClass("focus");

                        // $(".links line").removeClass("inactive");

                        // 显示标签为on的所有结点，如果switch开关处于off，则设置为inactive
                        d3.select('#canvas').selectAll(".nodes circle").attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            //位于group1且开关标签为on则显示
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else {
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        //选中标签开关为on的节点所连接的边
                        d3.select("#canvas").selectAll('.links line').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            //选中边上首尾节点属于同类，并且所属标签开关为开的节点给予显示
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + "inactive";
                            }
                        });
                        //选中标签节点为on中的所有文本节点显示
                        d3.select('#canvas').selectAll('.texts text').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // 当前选中类型实体显示
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                    }
                });

                $("#canvas").on("mouseenter", ".texts text", function (e) {
                    if (!isDragging) {
                        //取出当前鼠标进入节点的名字，以便后续进行节点隐藏
                        var focusedNode = $(this).attr("name");
                        // 确定显示模式
                        // 确定显示模式
                        $("#subclass").empty();
                        $("#description").empty();
                        $("#faceImageContainer1").empty();
                        $("#faceImageContainer2").empty();
                        $("#faceImageContainer3").empty();
                        $("#emojiImageContainer").empty();
                        $("#animalImageContainer").empty();
                        $("#animalImageContainer2").empty();
                        $("#animalImageContainer3").empty();
                        $("#tag1").empty();
                        $("#tag2").empty();
                        $("#tag3").empty();
                        $("#tag4").empty();
                        $("#tag5").empty();
                        $("#tag6").empty();

                        $("#labelProperty h4").css("color", $(this).attr("fill")).text($(this).attr("name"));
                        var labelInfo = labelInfoAll[focusedNode];
                        //针对不同类别情绪进行分类别展示（小类情绪词没有图片）
                        //对情绪大类的Property展示
                        if (EMOTIONS.indexOf(focusedNode) != -1 || focusedNode == "表情") {
                            // $("#labelProperty").append("image").attr()
                            // 展示子类情绪信息
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "子类" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");

                            // 为每个情感大类添加描述信息
                            $("#description")
                                .append("<div><span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "描述" + "</span><br></div>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.DESCRIPTION + "</span>");

                            if (focusedNode == "表情") {
                                var e;

                                $("#description")
                                    .append("<div><span class='label label-default' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>")

                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "1.png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                $("#tag1").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "2.png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                $("#tag2").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + IMAGE_CATEGORIES[i] + "6.png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }

                                $("#tag3").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>")
                                for (let i = 0; i < IMAGE_CATEGORIES.length; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + IMAGE_CATEGORIES[i] + "1.jpg" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#emojiImageContainer").append(e);
                                }

                                $("#tag4").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-cat-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer").append(e);
                                    }
                                }

                                $("#tag5").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-dog-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer2").append(e);
                                    }
                                }

                                $("#tag6").append("<br>");
                                for (let i = 0; i < IMAGE_CATEGORIES_ANIMALS.length; i++) {
                                    for (let j = 1; j <= 3; j++) {
                                        e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                        e += "./assets/images/animal-hamster-emotions/" + IMAGE_CATEGORIES_ANIMALS[i] + j + ".jpg" + "'";
                                        e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                        $("#animalImageContainer3").append(e);
                                    }
                                }
                            }

                            // 展示情感大类
                            else {
                                var emotionType = IMAGE_CATEGORIES[EMOTIONS.indexOf(focusedNode)];
                                var animalEmotionType = IMAGE_CATEGORIES_ANIMALS[EMOTIONS.indexOf(focusedNode)];

                                $("#description")
                                    .append("<div><span class='label' style='margin-left: -2px; background-color:#665d91;color: lightgrey;'>" + "人脸表情" + "</span><br></div>");

                                for (let i = 0; i < imageNums; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/human-face-emotions/" + emotionType + (i + 1) + ".png" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer1").append(e);
                                }

                                const emojiNums = 7;
                                $("#tag1").append("<br><div><span class='label' style='margin-left: -2px; background-color:#944b4b;color: lightgrey;'>" + "社交媒体表情" + "</span><br></div>")
                                for (let i = 0; i < emojiNums; i++) {
                                    e = "<li style='display: inline-block; width:57px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/social-media-emotions/" + emotionType + (i+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail' alt='Responsive image' style='padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer2").append(e);
                                }

                                var animalEmotionsNum = 3;
                                $("#tag2").append("<br><div><span class='label' style='margin-left: -2px; background-color:#227636;color: lightgrey;'>" + "动物表情" + "</span><br></div>")
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-cat-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-dog-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                                for (let j = 0; j < animalEmotionsNum; j++) {
                                    e = "<li style='display: inline-block; width:60px; padding-top: 4px; padding-bottom: 2px; padding-left: 2px; text-align:left; list-style:none;'><img src='";
                                    e += "./assets/images/animal-hamster-emotions/" + animalEmotionType + (j+1) + ".jpg" + "'";
                                    e += "class='img-responsive img-thumbnail imageItem' alt='Responsive image' style='position:relative; margin:1px 0px;padding:2px; width: 55px; height: 55px;'></li>";
                                    $("#faceImageContainer3").append(e);
                                }
                            }

                            // 展示情感小类
                        } else if (EMOTION_CATEGORIES.indexOf(focusedNode) != -1) {
                            $("#subclass")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "子类" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + labelInfo.SUBCLASS_OF + "</span>");
                        } else {
                            var propertyValue = Object.values(labelInfo);
                            var relatedEmotion;
                            if(propertyValue[1] == ""){
                                relatedEmotion  = "无"
                            } else{
                                relatedEmotion = propertyValue[1];
                            }
                            const wordPolarity = ["中性", "褒义", "贬义", "兼有"];

                            $("#description")
                                .append("<span class='label label-default' style='margin-left: -2px; color: lightgrey;'>" + "属于" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[0] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: cornflowerblue'>" + "相关" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + relatedEmotion + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #3e8e41'>" + "词性" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[2] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color: #a7a82e'>" + "强度" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[3] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background-color:#944b4b;'>" + "词义数" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + propertyValue[4] + "</span><br>")
                                .append("<span class='label ' style='margin-left: -2px; color: lightgrey;background:#665d91;'>" + "极性" + "</span><br>")
                                .append("<span style='color: #555555; font-size:12px; font-family:'Microsoft Yahei''>" + wordPolarity[propertyValue[5]] + "</span><br>");

                        }

                        //遍历所有文本结点，选出与聚焦节点直接相连的文本节点
                        d3.select("#canvas").selectAll(".texts text").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            //聚焦节点
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            // 显示与当前聚焦节点直接相连的节点
                            for (var i = 0; i < links.length; i++) {
                                if (links[i].source.id == focusedNode && links[i].target.id == d.id) {
                                    if (switcher[links[i].target.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                                if (links[i].target.id  == focusedNode && links[i].source.id  == d.id) {
                                    if (switcher[links[i].source.group]) {
                                        return addDarkModeClass;
                                    } else {
                                        return addDarkModeClass + "inactive";
                                    }
                                }
                            }
                            return addDarkModeClass + "inactive";
                        });

                        // 显示与当前聚焦节点直接相连的边
                        d3.select("#canvas").selectAll(".links line").attr("class", function (d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // console.log(d.source.id);
                            // console.log(focusedNode.name);
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass + 'focus';
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        // 只显示之间相连的关系名
                        d3.select("#canvas").selectAll('.lineTexts text').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.source.id == focusedNode || d.target.id == focusedNode) {
                                if (switcher[d.source.group] && switcher[d.target.group]) {
                                    return addDarkModeClass;
                                } else {
                                    return addDarkModeClass + "inactive";
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });

                        //当鼠标悬停于文本节点时，对所有Nodes节点进行隐藏
                        d3.select('#canvas').selectAll('.nodes circle').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (d.id == focusedNode) {
                                return addDarkModeClass;
                            }
                            for (var i = 0; i < links.length; i++) {
                                if (links[i]['source'].id == focusedNode && links[i]['target'].id == d.id) {
                                    return addDarkModeClass;
                                }
                                if (links[i]['target'].id == focusedNode && links[i]['source'].id == d.id) {
                                    return addDarkModeClass;
                                }
                            }
                            return addDarkModeClass + 'inactive';
                        });
                    }
                });

                //当鼠标不在聚焦到某个选定的节点时
                $('#canvas').on('mouseleave', '.texts text', function(event) {
                    if (!isDragging) {
                        //隐藏所有边的关系
                        $(".lineTexts text").addClass("inactive");
                        $(".links line").removeClass("focus");
                        // $(".links line").removeClass("inactive");
                        $(".nodes circle").removeClass("inactive");
                        // 显示标签为Off的所有文本结点，如果switch开关处于off并属于当前标签，则设置为active
                        d3.select('#canvas').selectAll(".texts text").attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                        //选中标签开关为on的节点所连接的边
                        d3.select("#canvas").selectAll('.links line').attr('class', function(d) {
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            if (switcher[d.source.group] && switcher[d.target.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + "inactive";
                            }
                        });
                        //选中标签节点为on中的所有文本节点显示
                        d3.select('#canvas').selectAll('.nodes node').attr('class', function(d){
                            var addDarkModeClass = '';
                            if (DARKMODE) {
                                addDarkModeClass = "darkMode ";
                            }
                            // 当前选中类型实体显示
                            if (switcher[d.group]) {
                                return addDarkModeClass;
                            } else{
                                return addDarkModeClass + 'inactive'
                            }
                        });
                    }
                });
            });
        });
    });
</script>
</html>